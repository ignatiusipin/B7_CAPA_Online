<style>
    @@media (min-width: 768px) {
        .modal-xl {
            width: 900%;
            max-width: 1000px;
        }
    }
</style>

<div class="modal fade" id="KajianResikoModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Form Kajian Risiko</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-lg-12">
                        <form>
                            <div class="row form-group col-md-12">
                                <div class="col-md-12">
                                    <label for="TxtPotensiKegagalan" class="col-form-label">Potensi kegagalan/penyimpangan yang mungkin terjadi ketika tindakan perbaikan/pencegahan diterapkan<span style="color: red;">*</span></label>
                                    <div class="input-group">
                                        <textarea type="text" class="form-control" name="TxtPotensiKegagalan" id="TxtPotensiKegagalan" required></textarea>
                                    </div>
                                </div>
                            </div>
                            <div class="row form-group col-md-12">
                                <div class="col-md-6">
                                    <label for="TxtDampak" class="col-form-label">Dampak<span style="color: red;">*</span></label>
                                    <div class="input-group">
                                        <textarea type="text" class="form-control" name="TxtDampak" id="TxtDampak"></textarea>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <label for="TxtSpesifikasi" class="col-form-label">Spesifikasi/Syarat<span style="color: red;">*</span></label>
                                    <div class="input-group">
                                        <textarea type="text" class="form-control" name="TxtSpesifikasi" id="TxtSpesifikasi"></textarea>
                                    </div>
                                </div>
                            </div>
                            <div class="row form-group col-md-12">
                                <div class="col-md-6">
                                    <label for="TxtPenyebabPotensial" class="col-form-label">Penyebab Potensial<span style="color: red;">*</span></label>
                                    <div class="input-group">
                                        <textarea type="text" class="form-control" name="TxtPenyebabPotensial" id="TxtPenyebabPotensial"></textarea>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <label for="TxtMPenyebabPotensial" class="col-form-label">Mengatasi Penyebab Potensial<span style="color: red;">*</span></label>
                                    <div class="input-group">
                                        <textarea type="text" class="form-control" name="TxtMPenyebabPotensial" id="TxtMPenyebabPotensial"></textarea>
                                    </div>
                                </div>
                            </div>
                            <div class="row form-group col-md-12">
                                <div class="col-md-6">
                                    <label for="TxtMPotensi_KLMD" class="col-form-label">Mencegah Potensi Kegagalan Lolos Menimbulkan Dampak<span style="color: red;">*</span></label>
                                    <div class="input-group">
                                        <textarea type="text" class="form-control" name="TxtMPotensi_KLMD" id="TxtMPotensi_KLMD"></textarea>
                                    </div>
                                </div>
                            </div>
                            <div class="row form-group col-md-12">
                                <div class="col-md-4">
                                    <label for="Severity_DDL" class="col-form-label">Severity<span style="color: red;">*</span></label>
                                    <div class="input-group">
                                        <select class="form-control select2 ddlModal" id="Severity_DDL" required>
                                            <option>Pilih</option>
                                            <option value="1" selected>1</option>
                                            <option value="4">4</option>
                                            <option value="7">7</option>
                                            <option value="10">10</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <label for="Likelihood_DDL" class="col-form-label">Likelihood<span style="color: red;">*</span></label>
                                    <div class="input-group">
                                        <select class="form-control select2 ddlModal" id="Likelihood_DDL" required>
                                            <option>Pilih</option>
                                            <option value="1" selected>1</option>
                                            <option value="2">2</option>
                                            <option value="4">4</option>
                                            <option value="8">8</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <label for="Detectability_DDL" class="col-form-label">Detectability<span style="color: red;">*</span></label>
                                    <div class="input-group">
                                        <select class="form-control select2 ddlModal" id="Detectability_DDL" required>
                                            <option>Pilih</option>
                                            <option value="1" selected>1</option>
                                            <option value="2">2</option>
                                            <option value="3">3</option>
                                            <option value="4">4</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            <div class="row form-group col-md-12">
                                <div class="form-group col-md-6">
                                    <label for="TxtRPN" class="col-form-label">RPN<span style="color: red;">*</span></label>
                                    <div class="input-group">
                                        <input type="text" class="form-control" name="TxtRPN" id="TxtRPN" readonly />
                                    </div>
                                </div>
                                <div class="form-group col-md-6">
                                    <label for="TxtRiskLevel" class="col-form-label">Risk Level<span style="color: red;">*</span></label>
                                    <div class="input-group">
                                        <input type="text" class="form-control" name="TxtRiskLevel" id="TxtRiskLevel" readonly />
                                    </div>
                                </div>
                            </div>

                            <div class="form-group col-md-3">
                                <label for="Target_DDL" class="col-form-label">Target<span style="color: red;">*</span></label>
                                <div class="input-group">
                                    <select class="form-control select2" id="Target_DDL" required>
                                        <option value="Low" selected>Low</option>
                                        <option value="Medium">Medium</option>
                                    </select>
                                </div>
                            </div>

                            <div class="row form-group col-md-12">
                                <div class="col-md-6">
                                    <label for="TxtMPotensi_K" class="col-form-label">Menghilangkan Potensi Kegagalan/Penyimpangan<span style="color: red;">*</span></label>
                                    <div class="input-group">
                                        <textarea type="text" class="form-control" name="TxtMPotensi_K" id="TxtMPotensi_K"></textarea>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <label for="TxtMPenyebab_P" class="col-form-label">Perbaikan untuk mengatasi Penyebab Potensial<span style="color: red;">*</span></label>
                                    <div class="input-group">
                                        <textarea type="text" class="form-control" name="TxtMPenyebab_P" id="TxtMPenyebab_P"></textarea>
                                    </div>
                                </div>
                            </div>

                            <div class="row form-group col-md-12">
                                <div class="col-md-6">
                                    <label for="TxtDPotensi_K" class="col-form-label">Perbaikan untuk meningkatkan deteksi potensi kegagalan<span style="color: red;">*</span></label>
                                    <div class="input-group">
                                        <textarea type="text" class="form-control" name="TxtDPotensi_K" id="TxtDPotensi_K"></textarea>
                                    </div>
                                </div>
                            </div>

                            <div class="row form-group col-md-12">
                                <div class="col-md-4">
                                    <label for="Severity2_DDL" class="col-form-label">Severity<span style="color: red;">*</span></label>
                                    <div class="input-group">
                                        <select class="form-control select2 ddlModal" id="Severity2_DDL" required>
                                            <option>Pilih</option>
                                            <option value="1" selected>1</option>
                                            <option value="4">4</option>
                                            <option value="7">7</option>
                                            <option value="10">10</option>
                                        </select>
                                    </div>
                                </div>

                                <div class="col-md-4">
                                    <label for="Likelihood2_DDL" class="col-form-label">Likelihood<span style="color: red;">*</span></label>
                                    <div class="input-group">
                                        <select class="form-control select2 ddlModal" id="Likelihood2_DDL" required>
                                            <option>Pilih</option>
                                            <option value="1" selected>1</option>
                                            <option value="2">2</option>
                                            <option value="4">4</option>
                                            <option value="8">8</option>
                                        </select>
                                    </div>
                                </div>

                                <div class="col-md-4">
                                    <label for="Detectability2_DDL" class="col-form-label">Detectability<span style="color: red;">*</span></label>
                                    <div class="input-group">
                                        <select class="form-control select2 ddlModal" id="Detectability2_DDL" required>
                                            <option>Pilih</option>
                                            <option value="1" selected>1</option>
                                            <option value="2">2</option>
                                            <option value="3">3</option>
                                            <option value="4">4</option>
                                        </select>
                                    </div>
                                </div>
                            </div>

                            <div class="row form-group col-md-12">
                                <div class="col-md-6">
                                    <label for="TxtRPN2" class="col-form-label">RPN<span style="color: red;">*</span></label>
                                    <div class="input-group">
                                        <input type="text" class="form-control" name="TxtRPN2" id="TxtRPN2" readonly />
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <label for="TxtRiskLevel2" class="col-form-label">Risk Level</label>
                                    <div class="input-group">
                                        <input type="text" class="form-control" name="TxtRiskLevel2" id="TxtRiskLevel2" readonly />
                                    </div>
                                </div>
                            </div>

                            <div class="row form-group col-md-12">
                                <div class="col-md-4">
                                    <label for="TxtPIC" class="col-form-label">PIC<span style="color: red;">*</span></label>
                                    <div class="input-group">
                                        <input type="text" class="form-control" name="TxtPIC" id="TxtPIC" readonly />
                                    </div>
                                </div>
                                <div class="col-md-2">
                                    <label for="DueDate_Kajian" class="col-form-label">Due Date<span style="color: red;">*</span></label>
                                    <div class="input-group">
                                        <input type="date" id="DueDate_Kajian" class="form-control form-control-sm">
                                    </div>
                                </div>
                            </div>

                            <div class="row form-group col-md-12">
                                <div class="col-md-4">
                                    <label for="TxtLainnya" class="col-form-label">Lainnya<span style="color: red;">*</span></label>
                                    <div class="input-group">
                                        <textarea type="text" class="form-control" name="TxtLainnya" id="TxtLainnya"></textarea>
                                    </div>
                                </div>
                            </div>

                            <div class="form-group col-md-6">
                                <button type="button" class="btn btn-primary" id="btn_KajianResiko">Tambahkan</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

<div class="card">
    <div class="card-body">
        <h4 class="card-title">Kajian Risiko</h4>
        <div class="row form-group">
            <div class="col-md-7">
                <select id="RootCause_KajianResikoDDL" class="form-control">
                </select>
            </div>
            <div class="col-md-3">
                <button type="button" id="btn_AddKajian" class="btn btn-dark mb-2" data-toggle="modal" data-target="#KajianResikoModal">Tambahkan Kajian Risiko</button>
            </div>
        </div>
        <div class="table-responsive mb-3" style="border: 1px solid #DCDCDC;">
            <table class="table table-striped table-bordered zero-configuration" id="Tbl_KajianResiko">
                <thead>
                    <tr>
                        <th id="tblHeaderTindakan">Tindakan</th>
                        <th>Potensi Kegagalan / Penyimpangan yang mungkin terjadi ketika tindakan perbaikan/pencegahan diterapkan</th>
                        <th>Spesifikasi / Syarat</th>
                        <th>Dampak</th>
                        <th>Severity (S)</th>
                        <th>Penyebab Potensial</th>
                        <th>Mengatasi Penyebab Potensial</th>
                        <th>Likelihood (L)</th>
                        <th>Mencegah Potensi Kegagalan Lolos Menimbulkan Dampak</th>
                        <th>Detectability (D) </th>
                        <th>RPN (SxLxD)</th>
                        <th>Risk Level</th>
                        <th>TARGET</th>
                        <th>Menghilangkan Potensi Kegagalan/ Penyimpangan</th>
                        <th>Severity (S)</th>
                        <th>PERBAIKAN untuk mengatasi Penyebab Potensial</th>
                        <th>Likelihood (L)</th>
                        <th>PERBAIKAN untuk meningkatkan deteksi potensi kegagalan</th>
                        <th>Detectability (D)</th>
                        <th>RPN (SxLxD)</th>
                        <th>Risk Level</th>
                        <th>PIC</th>
                        <th>Due Date</th>
                        <th>Lainnya</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody id="Tbl_PRCA">
                    @*<tr>
                        <td>Potensi</td>
                        <td>Tindakan</td>
                        <td><input type="text" class="form-control form-control-sm" style="width:100%;"></td>
                        <td><input type="text" class="form-control form-control-sm" style="width:100%;"></td>
                        <td><input type="text" class="form-control form-control-sm" style="width:100%;"></td>
                        <td>
                            <select id="SaverityDDL" class="form-control">
                                <option value="1">1</option>
                                <option value="4">4</option>
                                <option value="7">7</option>
                                <option value="10">10</option>
                            </select>
                        </td>
                        <td><input type="text" class="form-control form-control-sm" style="width:100%;"></td>
                        <td><input type="text" class="form-control form-control-sm" style="width:100%;"></td>
                        <td>
                            <select id="LikelihoodDDL" class="form-control">
                                <option value="1">1</option>
                                <option value="2">2</option>
                                <option value="4">4</option>
                                <option value="8">8</option>
                            </select>
                        </td>
                        <td><input type="text" class="form-control form-control-sm" style="width:100%;"></td>
                        <td>
                            <select id="DetectabilityDDL" class="form-control">
                                <option value="1">1</option>
                                <option value="2">2</option>
                                <option value="3">3</option>
                                <option value="4">4</option>
                            </select>
                        </td>
                        <td>SxLxD</td>
                        <td>Level Risk Color</td>
                        <td>
                            <select id="DetectabilityDDL" class="form-control">
                                <option value="Low">Low</option>
                                <option value="Medium">Medium</option>
                            </select>
                        </td>
                        <td><input type="text" class="form-control form-control-sm" style="width:100%;"></td>
                        <td>
                            <select id="LikelihoodDDL" class="form-control">
                                <option value="1">1</option>
                                <option value="2">2</option>
                                <option value="4">4</option>
                                <option value="8">8</option>
                            </select>
                        </td>
                        <td><input type="text" class="form-control form-control-sm" style="width:100%;"></td>
                        <td>
                            <select id="DetectabilityDDL" class="form-control">
                                <option value="1">1</option>
                                <option value="2">2</option>
                                <option value="3">3</option>
                                <option value="4">4</option>
                            </select>
                        </td>
                        <td><input type="text" class="form-control form-control-sm" style="width:100%;"></td>
                        <td>
                            <select id="DetectabilityDDL" class="form-control">
                                <option value="1">1</option>
                                <option value="2">2</option>
                                <option value="3">3</option>
                                <option value="4">4</option>
                            </select>
                        </td>
                        <td>SxLxD</td>
                        <td>Level Risk Color</td>
                        <td>PIC</td>
                        <td>Due Date</td>
                        <td>Lainnya</td>
                        <td><button class="form-control-sm">Delete</button></td>
                    </tr>*@
                </tbody>
            </table>
        </div>

        @*<div class="row form-group-sm mt-4">
                <div class="col-md-6">
                    <button class="btn mb-1 btn-primary" id="btn_Submit">Submit</button>
                </div>
            </div>*@
    </div>
</div>

<script>

    function KajianResikoDDLPV() {
        $.ajax({
            url: '/PIC/GetDataPIC',
            type: 'post',
            data: JSON.stringify({
                Option: 10,
                SP: "[dbo].[SP_FORM_CAPA]"
            }),
            dataType: 'json',
            contentType: 'application/json; charset=utf-8',
            success: function (data) {
                $('#RootCause_KajianResikoDDL').empty();
                $.each(JSON.parse(data), function (key, value) {
                    $('#RootCause_KajianResikoDDL').append(new Option(value.WhyDesc, value.WhyDesc));
                });
            },
            error: function (ex) {
                alert(JSON.stringify(ex));
            }
        });
    }
    function TableKajianPV() {
        $.ajax({
            url: '/PIC/GetKajianResiko',
            type: 'post',
            data: JSON.stringify({
                Model: {
                    NO_CAPA: $('#input_NoCAPA').val(),
                    Option: 11,
                    Aspect: '',
                    WSBH: '',
                    WAH: '',
                    Status: '',
                    isParent: '',
                    WHY_Parent: '',
                    WHY: '',
                    Tindakan: '',
                    Pelaksana: '',
                    LineNumber: '',
                    NamaPersonil: '',
                    Email: '',
                    DueDate: '',
                    Is_AreaLain: '',
                    WhyID: '',
                    WhyParentID: '',
                    RootCause: ''
                }
            }),
            dataType: 'json',
            contentType: 'application/json; charset=utf-8',
            success: function (data) {
                console.log(data);
                $('#Tbl_KajianResiko').DataTable({
                    "pageLength": 5,
                    "lengthChange": true,
                    "searching": false,
                    "data": JSON.parse(data),
                    "select": true,
                    "bDestroy": true,
                    "scrollCollapse": true,
                    "columns": [
                        { "data": "Tindakan" },
                        { "data": "P_Kegagalan" },
                        { "data": "Spek" },
                        { "data": "Dampak" },
                        { "data": "Severity" },
                        { "data": "Penyebab" },
                        { "data": "M_Penyebab" },
                        { "data": "Likelihood" },
                        { "data": "M_PKegagalan_LMD" },
                        { "data": "Detectability" },
                        { "data": "RPN" },
                        {
                            "data": "RiskLevel",
                            "className": "riskLevel"
                        },
                        { "data": "Target" },
                        { "data": "M_PKegagalan" },
                        { "data": "Severity2" },
                        { "data": "P_MPenyebab" },
                        { "data": "Likelihood2" },
                        { "data": "P_MDPKegagalan" },
                        { "data": "Detectability2" },
                        { "data": "RPN2" },
                        {
                            "data": "RiskLevel2",
                            "className": "riskLevel2"
                        },
                        { "data": "PIC" },
                        { "data": "DueDate" },
                        { "data": "Lainnya" },
                        {
                            "data": null,
                            "defaultContent": "<button class='btn btn-danger delete' type='button' name='delete' onchange=''>Delete</button> ",
                            "visible": (!isHide) ? (true) : (false)
                        },
                    ],
                    "order": [[1, 'asc']],
                    "rowCallback": function (row, data) {
                        ColoredColumns(row, data.RiskLevel, "riskLevel");
                        ColoredColumns(row, data.RiskLevel2, "riskLevel2");
                    }
                });
            },
            error: function (ex) {
                alert(JSON.stringify(ex));
            }
        });
    }
    var isHide = false;
    function ColoredColumns(row, d, className) {
        if (d == "Low") {
            $('td.' + className, row).css({
                background: "limegreen",
                color: "#C0C0C0"
            });
        } else if (d == "Medium") {
            $('td.' + className, row).css({
                background: "yellow",
                color: "#C0C0C0"
            });
        } else if (d == "High") {
            $('td.' + className, row).css({
                background: "red",
                color: "#C0C0C0"
            });
        } else if (d == "Very High") {
            $('td.' + className, row).css({
                background: "black",
                color: "#C0C0C0"
            });
        }
    }//d = data
</script>