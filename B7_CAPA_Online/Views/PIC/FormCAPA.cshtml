r
@{
    ViewBag.Title = "FormCAPA";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<style>
    @@media (min-width: 768px) {
        .modal-xl {
            width: 900%;
            max-width: 1300px;
        }
    }
</style>

<link href="~/Content/Scripts/plugins/datatables/css/jquery.dataTables.min.css" rel="stylesheet" />

<div class="content-body">
    <!--Modal-->
    <div class="modal fade" id="KajianResikoModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-xl" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">Form Kajian Resiko</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-lg-12">
                            <form>
                                <div class="row form-group col-md-12">
                                    <div class="col-md-6">
                                        <label for="TxtPotensiKegagalan" class="col-form-label">Potensi Kegagalan / Penyimpangan yang mungkin terjadi ketika tindakan perbaikan/pencegahan diterapkan</label>
                                        <div class="input-group">
                                            <textarea type="text" class="form-control" name="TxtPotensiKegagalan" id="TxtPotensiKegagalan"></textarea>
                                        </div>
                                    </div>
                                </div>
                                <div class="row form-group col-md-12">
                                    <div class="col-md-6">
                                        <label for="TxtDampak" class="col-form-label">Dampak</label>
                                        <div class="input-group">
                                            <textarea type="text" class="form-control" name="TxtDampak" id="TxtDampak"></textarea>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <label for="TxtSpesifikasi" class="col-form-label">Spesifikasi / Syarat</label>
                                        <div class="input-group">
                                            <textarea type="text" class="form-control" name="TxtSpesifikasi" id="TxtSpesifikasi"></textarea>
                                        </div>
                                    </div>
                                </div>
                                <div class="row form-group col-md-12">
                                    <div class="col-md-6">
                                        <label for="TxtPenyebabPotensial" class="col-form-label">Penyebab Potensial</label>
                                        <div class="input-group">
                                            <textarea type="text" class="form-control" name="TxtPenyebabPotensial" id="TxtPenyebabPotensial"></textarea>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <label for="TxtMPenyebabPotensial" class="col-form-label">Mengatasi Penyebab Potensial</label>
                                        <div class="input-group">
                                            <textarea type="text" class="form-control" name="TxtMPenyebabPotensial" id="TxtMPenyebabPotensial"></textarea>
                                        </div>
                                    </div>
                                </div>
                                <div class="row form-group col-md-12">
                                    <div class="col-md-6">
                                        <label for="TxtMPotensi_KLMD" class="col-form-label">Mencegah Potensi Kegagalan Lolos Menimbulkan Dampak</label>
                                        <div class="input-group">
                                            <textarea type="text" class="form-control" name="TxtMPotensi_KLMD" id="TxtMPotensi_KLMD"></textarea>
                                        </div>
                                    </div>
                                </div>
                                <div class="row form-group col-md-12">
                                    <div class="col-md-4">
                                        <label for="Severity_DDL" class="col-form-label">Severity</label>
                                        <div class="input-group">
                                            <select class="form-control select2" id="Severity_DDL" required>
                                                <option value="1">1</option>
                                                <option value="4">4</option>
                                                <option value="7">7</option>
                                                <option value="10">10</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <label for="Likelihood_DDL" class="col-form-label">Likelihood</label>
                                        <div class="input-group">
                                            <select class="form-control select2" id="Likelihood_DDL" required>
                                                <option value="1">1</option>
                                                <option value="2">2</option>
                                                <option value="4">4</option>
                                                <option value="8">8</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <label for="Detectability_DDL" class="col-form-label">Detectability</label>
                                        <div class="input-group">
                                            <select class="form-control select2" id="Detectability_DDL" required>
                                                <option value="1">1</option>
                                                <option value="2">2</option>
                                                <option value="3">3</option>
                                                <option value="4">4</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                                <div class="row form-group col-md-12">
                                    <div class="form-group col-md-6">
                                        <label for="TxtRPN" class="col-form-label">RPN</label>
                                        <div class="input-group">
                                            <input type="text" class="form-control" name="TxtRPN" id="TxtRPN" readonly />
                                        </div>
                                    </div>
                                    <div class="form-group col-md-6">
                                        <label for="TxtRiskLevel" class="col-form-label">Risk Level</label>
                                        <div class="input-group">
                                            <input type="text" class="form-control" name="TxtRiskLevel" id="TxtRiskLevel" readonly />
                                        </div>
                                    </div>
                                </div>

                                <div class="form-group col-md-3">
                                    <label for="Target_DDL" class="col-form-label">Target</label>
                                    <div class="input-group">
                                        <select class="form-control select2" id="Target_DDL" required>
                                            <option value="Low">Low</option>
                                            <option value="Medium">Medium</option>
                                        </select>
                                    </div>
                                </div>

                                <div class="row form-group col-md-12">
                                    <div class="col-md-6">
                                        <label for="TxtMPotensi_K" class="col-form-label">Menghilangkan Potensi Kegagalan/ Penyimpangan</label>
                                        <div class="input-group">
                                            <textarea type="text" class="form-control" name="TxtMPotensi_K" id="TxtMPotensi_K"></textarea>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <label for="TxtMPenyebab_P" class="col-form-label">Perbaikan untuk mengatasi Penyebab Potensial</label>
                                        <div class="input-group">
                                            <textarea type="text" class="form-control" name="TxtMPenyebab_P" id="TxtMPenyebab_P"></textarea>
                                        </div>
                                    </div>
                                </div>

                                <div class="row form-group col-md-12">
                                    <div class="col-md-6">
                                        <label for="TxtDPotensi_K" class="col-form-label">Perbaikan untuk meningkatkan deteksi potensi kegagalan</label>
                                        <div class="input-group">
                                            <textarea type="text" class="form-control" name="TxtDPotensi_K" id="TxtDPotensi_K"></textarea>
                                        </div>
                                    </div>
                                </div>

                                <div class="row form-group col-md-12">
                                    <div class="col-md-4">
                                        <label for="Severity2_DDL" class="col-form-label">Severity</label>
                                        <div class="input-group">
                                            <select class="form-control select2" id="Severity2_DDL" required>
                                                <option value="1">1</option>
                                                <option value="4">4</option>
                                                <option value="7">7</option>
                                                <option value="10">10</option>
                                            </select>
                                        </div>
                                    </div>

                                    <div class="col-md-4">
                                        <label for="Likelihood2_DDL" class="col-form-label">Likelihood</label>
                                        <div class="input-group">
                                            <select class="form-control select2" id="Likelihood2_DDL" required>
                                                <option value="1">1</option>
                                                <option value="2">2</option>
                                                <option value="4">4</option>
                                                <option value="8">8</option>
                                            </select>
                                        </div>
                                    </div>

                                    <div class="col-md-4">
                                        <label for="Detectability2_DDL" class="col-form-label">Detectability</label>
                                        <div class="input-group">
                                            <select class="form-control select2" id="Detectability2_DDL" required>
                                                <option value="1">1</option>
                                                <option value="2">2</option>
                                                <option value="3">3</option>
                                                <option value="4">4</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>

                                <div class="row form-group col-md-12">
                                    <div class="col-md-6">
                                        <label for="TxtRPN2" class="col-form-label">RPN</label>
                                        <div class="input-group">
                                            <input type="text" class="form-control" name="TxtRPN2" id="TxtRPN2" readonly />
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <label for="TxtRiskLevel2" class="col-form-label">Risk Level</label>
                                        <div class="input-group">
                                            <input type="text" class="form-control" name="TxtRiskLevel2" id="TxtRiskLevel2" readonly />
                                        </div>
                                    </div>
                                </div>

                                <div class="row form-group col-md-12">
                                    <div class="col-md-4">
                                        <label for="TxtPIC" class="col-form-label">PIC</label>
                                        <div class="input-group">
                                            <input type="text" class="form-control" name="TxtPIC" id="TxtPIC" readonly />
                                        </div>
                                    </div>
                                    <div class="col-md-2">
                                        <label for="DueDate_Kajian" class="col-form-label">Due Date</label>
                                        <div class="input-group">
                                            <input type="date" id="DueDate_Kajian" class="form-control form-control-sm">
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="form-group col-md-6">
                                    <button type="button" class="btn btn-primary" id="btn_Search_Deviation">Tambahkan</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <div class="row page-titles mx-0">
        <div class="col p-md-0">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="javascript:void(0)">Dashboard</a></li>
                <li class="breadcrumb-item active"><a href="javascript:void(0)">Form CAPA</a></li>
            </ol>
        </div>
    </div>
    <!-- row -->

    <div class="container-fluid">
        <div class="row">
            <div class="col-lg-12">
                <div class="card">
                    <div class="card-body">
                        <h4 class="card-title">Form CAPA</h4>
                        <form>
                            <div class="row">
                                <div class="form-group mb-2 col-sm-3">
                                    <label class="m-t-20">Tanggal</label>
                                    <input type="text" id="date-format" class="form-control form-control-sm" value="@DateTime.Today.ToShortDateString()" readonly>
                                </div>
                                <div class="form-group mb-2 col-sm-3">
                                    <label class="m-t-40">Requestor</label>
                                    <input class="form-control form-control-sm" type="text" id="input_Requestor" readonly>
                                </div>
                                <div class="form-group mb-2 col-sm-3">
                                    <label class="m-t-20">Nomor CAPA</label>
                                    <input class="form-control form-control-sm" type="text" id="input_NoCAPA" value="@Request.QueryString["CAPA"]" readonly>
                                </div>
                                <div class="form-group mb-2 col-sm-3">
                                    <label class="m-t-40">Departemen</label>
                                    <input class="form-control form-control-sm" type="text" id="input_Departemen" readonly>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>

                <div class="card">
                    <div class="card-body">
                        <h4 class="card-title">Request Page</h4>
                        <button class="btn btn-dark form-control col-sm-2">Request</button>
                    </div>
                </div>

                <div class="card">
                    <div class="card-body">
                        <h4 class="card-title">Analisa Kondisi</h4>
                        <div class="table-responsive">
                            <table class="table table-striped table-bordered zero-configuration">
                                <thead>
                                    <tr>
                                        <th>Aspect</th>
                                        <th>WHAT SHOULD BE HAPPENED</th>
                                        <th>WHAT ACTUALLY HAPPENED</th>
                                        <th style="text-align: center">OK/NOK</th>
                                        <th>Action</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>
                                            <select class="form-control form-control-sm" id="Select_AspectKondisi">
                                                <option>Manusia</option>
                                                <option>Material/Produk</option>
                                                <option>Metode</option>
                                                <option>Mesin</option>
                                                <option>Lingkungan</option>
                                            </select>
                                        </td>
                                        <td><input type="text" class="form-control form-control-sm" style="width:100%;" id="TxtWSBH"></td>
                                        <td><input type="text" class="form-control form-control-sm" style="width:100%;" id="TxtWAH"></td>
                                        <td>
                                            @*<input type="text" class="form-control form-control-sm" style="width:100%;" id="TxtStatus">*@
                                            <div class="radio" style="text-align: center">
                                                <label class="radio-inline mr-3">
                                                    <input type="radio" name="optradio" value="OK"> OK
                                                </label>
                                                <label class="radio-inline mr-3">
                                                    <input type="radio" name="optradio" value="NOT OK"> NOT OK
                                                </label>
                                            </div>
                                        </td>
                                        <th><button class="form-control-sm" id="btn_AddKondisi">Add</button></th>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        <div class="table-responsive">
                            <table class="table table-hover table-bordered zero-configuration" id="Tbl_Kondisi">
                                <thead>
                                    <tr>
                                        <th>No</th>
                                        <th>Aspect</th>
                                        <th>WHAT SHOULD BE HAPPENED</th>
                                        <th>WHAT ACTUALLY HAPPENED</th>
                                        <th style="text-align: center">OK/NOK</th>
                                        <th>Action</th>
                                    </tr>
                                </thead>
                                <tbody id="Tbl_Analisa">
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <div class="card" id="Div_PRCA">
                    <div class="card-body">
                        <h4 class="card-title">Potential Root Cause Analysis</h4>
                        @*<div class="table-responsive">
                                <!--<table class="table table-striped table-bordered zero-configuration">
                                    <thead>
                                        <tr>
                                            <th>Aspect</th>
                                            <th>WHAT ACTUALLY HAPPENED</th>
                                            <th>WHY</th>
                                            <th>Action</th>
                                        </tr>
                                    </thead>
                                    <tbody id="Tbl_PRCA">
                                        <tr>-->
                                            @*<td>Manusia</td>
                            <td><input type="text" class="form-control form-control-sm" style="width:100%;" readonly></td>
                            <td><input type="text" class="form-control form-control-sm" style="width:100%;"></td>
                            <th><button class="form-control-sm">Add</button></th>
                                        <!--</tr>
                                    </tbody>
                                </table>
                            </div>-->*@
                        <form>
                            <div class="row form-group-sm mb-2">
                                <div class="col-md-6">
                                    <label class="m-t-20">Aspect<span style="color: red">*</span></label>
                                    <select class="form-control form-control-sm" id="Aspect_DDL" name="Aspect" required>
                                    </select>
                                </div>
                            </div>
                            <div class="row form-group-sm mb-3">
                                <div class="col-md-6">
                                    <label class="m-t-20">What Actually Happened<span style="color: red">*</span></label>
                                    <select class="form-control form-control-sm" id="WAH_DDL" name="WAH" required>
                                    </select>
                                </div>
                            </div>
                            <div class="row form-group-sm mb-2">
                                <div class="col-md-6">
                                    <label class="m-t-20">Parent?<span style="color: red; visibility: hidden">**</span></label>
                                    <input class="checkbox" type="checkbox" value="Yes" id="isParent" />
                                </div>
                            </div>
                            <div class="row form-group-sm mb-2" id="Div_WhyParent">
                                <div class="col-md-6">
                                    <label class="m-t-20">Why Parent<span style="color: red">*</span></label>
                                    <select class="form-control form-control-sm" id="WhyParent_DDL" name="WhyParent_DDL">
                                    </select>
                                </div>
                            </div>
                            <div class="row form-group-sm mb-2">
                                <div class="col-md-6">
                                    <label class="m-t-20">Why<span style="color: red">*</span></label>
                                    <input class="form-control" type="text" id="TxtWhy" />
                                </div>
                            </div>
                            <div class="row form-group-sm mb-2">
                                <div class="col-md-6">
                                    <button class="form-control-sm" type="button" id="btn_AddWhy">Add</button>
                                </div>
                            </div>
                        </form>

                    </div>
                </div>

                <div class="card">
                    <div class="card-body">
                        <h4 class="card-title">Why</h4>
                        <div class="table-responsive">
                            <table class="table table-striped table-bordered zero-configuration">
                                <thead>
                                    <tr>
                                        <th>WHAT ACTUALLY HAPPENED</th>
                                        <th>WHY</th>
                                        <th>Action</th>
                                    </tr>
                                </thead>
                                <tbody id="Tbl_Why">
                                    <tr>
                                        @*<td>Manusia</td>
                                            <td><input type="text" class="form-control form-control-sm" style="width:100%;" readonly></td>
                                            <td><input type="text" class="form-control form-control-sm" style="width:100%;"></td>
                                            <th><button class="form-control-sm">Add</button></th>*@
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-body">
                        <h4 class="card-title">Penentuan Tindakan Perbaikan</h4>
                        <div class="table-responsive">
                            <form>
                                <div class="row form-group-sm">
                                    <div class="col-md-6">
                                        <label class="m-t-20">Root Cause</label>
                                        <select id="RootCause_DDL" class="form-control">
                                        </select>
                                    </div>
                                </div>
                                <div class="row form-group-sm">
                                    <div class="col-md-6">
                                        <label class="m-t-20">Tindakan Perbaikan<span style="color: red">*</span></label>
                                        <textarea type="text" class="form-control" placeholder="Deskripsi" id="TxtDeskripsiPerbaikan"></textarea>
                                    </div>
                                    <div class="form-group mb-2 col-sm-3">
                                        <label class="m-t-20">Due Date</label>
                                        <input type="date" id="duedate_perbaikan" class="form-control form-control-sm">
                                    </div>
                                </div>
                                <div class="row form-group">
                                    <div class="col-md-6">
                                        <label class="m-t-40">Pelaksana Tindakan Perbaikan</label>
                                        <div class="input-group mb-3">
                                            <input type="text" class="form-control" id="TxtPelaksanaPerbaikan">
                                        </div>
                                    </div>
                                    @*<div class="col-md-4" style="text-align: center">
                                            <label class="m-t-40" style="visibility:hidden">_</label>
                                            <div class="input-group mb-3">
                                                <button type="button" class="btn mb-1 btn-primary ">Add</button>
                                                <button type="button" class="btn mb-1 btn-primary ">Browse</button>
                                            </div>
                                        </div>*@
                                    <div class="col-md-3">
                                        <label class="m-t-40">Nama Personil</label>
                                        <div class="input-group mb-3">
                                            <input type="text" class="form-control" id="TxtNamaPersonil">
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <label class="m-t-40">Alamat Email</label>
                                        <div class="input-group">
                                            <input type="text" class="form-control" id="TxtEmailPelaksana">
                                        </div>
                                    </div>

                                    <div class="col-md-12">
                                        <label class="m-t-40">Apakah ada proses / area lain yang berpotensi sama ?</label>
                                        <div class="radio input-group">
                                            <div class="col-sm-3">
                                                <label><input type="radio" value="Yes" name="Potensi">Ya</label>
                                            </div>
                                            <div class="col-sm-3">
                                                <label><input type="radio" value="No" name="Potensi">Tidak</label>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="col-md-12 mb-3">
                                        <label class="m-t-40" style="visibility: hidden">_</label>
                                        <div class="input-group">
                                            <button type="button" id="btn_AddPerbaikan" class="btn mb-1 btn-primary ">Tambahkan Tindakan Perbaikan</button>
                                        </div>
                                    </div>

                                </div>
                            </form>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-body">
                        <h4 class="card-title">Penentuan Tindakan Pencegahan</h4>
                        <div class="table-responsive">
                            <form>
                                <div class="row form-group-sm">
                                    <div class="col-md-6">
                                        <label class="m-t-20">Area / Proses lain yang Berpotensi</label>
                                        <select id="AreaLain_DDL" class="form-control">
                                        </select>
                                    </div>
                                </div>
                                <div class="row form-group-sm">
                                    <div class="col-md-6">
                                        <label class="m-t-20">Tindakan Pencegahan<span style="color: red">*</span></label>
                                        <textarea type="text" class="form-control" id="TxtDeskripsiPencegahan" placeholder="Deskripsi"></textarea>
                                    </div>
                                    <div class="form-group mb-2 col-sm-3">
                                        <label class="m-t-20">Due Date</label>
                                        <input type="date" id="duedate_pencegahan" class="form-control form-control-sm">
                                    </div>
                                </div>
                                <div class="row form-group">
                                    <div class="col-md-6">
                                        <label class="m-t-40">Pelaksana Tindakan Pencegahan</label>
                                        <div class="input-group mb-3">
                                            <input type="text" class="form-control" id="TxtPelaksanaPencegahan">
                                        </div>
                                    </div>

                                    <div class="col-md-3">
                                        <label class="m-t-40">Nama Personil</label>
                                        <div class="input-group mb-3">
                                            <input type="text" class="form-control" id="TxtNamaPersonilPencegahan">
                                        </div>
                                    </div>

                                    <div class="col-md-6">
                                        <label class="m-t-40">Alamat Email</label>
                                        <div class="input-group">
                                            <input type="text" class="form-control" id="TxtEmailPencegahan">
                                        </div>
                                    </div>

                                    <div class="col-md-12 mb-3">
                                        <label class="m-t-40" style="visibility: hidden">_</label>
                                        <div class="input-group">
                                            <button type="button" id="btn_AddPencegahan" class="btn mb-1 btn-primary ">Tambahkan Tindakan Pencegahan</button>
                                        </div>
                                    </div>

                                </div>
                            </form>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-body">
                        <h4 class="card-title">Kajian Resiko</h4>
                        <div class="row form-group">
                            <div class="col-md-7">
                                <select id="RootCause_KajianResikoDDL" class="form-control">
                                </select>
                            </div>
                            <div class="col-md-3">
                                <button type="button" id="btn_AddKajian" class="btn btn-dark mb-2" data-toggle="modal" data-target="#KajianResikoModal">Tambahkan Kajian Resiko</button>
                            </div>
                        </div>
                        <div class="table-responsive" style="border: 1px solid #DCDCDC;">
                            <table class="table table-striped table-bordered zero-configuration" id="Tbl_KajianResiko">
                                <thead>
                                    <tr>
                                        <th>Potensi Kegagalan / Penyimpangan yang mungkin terjadi ketika tindakan perbaikan/pencegahan diterapkan</th>
                                        <th>Spesifikasi / Syarat</th>
                                        <th>Dampak</th>
                                        <th>Severity (S)</th>
                                        <th>Penyebab Potensial</th>
                                        <th>Mengatasi Penyebab Potensial</th>
                                        <th>Likelihood (L)</th>
                                        <th>Mencegah Potensi Kegagalan Lolos Menimbulkan Dampak</th>
                                        <th>Detectability (D) </th>
                                        <th>RPN (SxLxD)</th>
                                        <th style="background-color: limegreen">Risk Level</th>
                                        <th>TARGET</th>
                                        <th>Menghilangkan Potensi Kegagalan/ Penyimpangan</th>
                                        <th>Severity (S)</th>
                                        <th>PERBAIKAN untuk mengatasi Penyebab Potensial</th>
                                        <th>Likelihood (L)</th>
                                        <th>PERBAIKAN untuk meningkatkan deteksi potensi kegagalan</th>
                                        <th>Detectability (D)</th>
                                        <th>RPN (SxLxD)</th>
                                        <th style="background-color: limegreen">Risk Level</th>
                                        <th>PIC</th>
                                        <th>Due Date</th>
                                        <th>Action</th>
                                    </tr>
                                </thead>
                                <tbody id="Tbl_PRCA">
                                    <tr>
                                        <td><input type="text" class="form-control form-control-sm" style="width:100%;"></td>
                                        <td><input type="text" class="form-control form-control-sm" style="width:100%;"></td>
                                        <td><input type="text" class="form-control form-control-sm" style="width:100%;"></td>
                                        <td>
                                            <select id="SaverityDDL" class="form-control">
                                                <option value="1">1</option>
                                                <option value="4">4</option>
                                                <option value="7">7</option>
                                                <option value="10">10</option>
                                            </select>
                                        </td>
                                        <td><input type="text" class="form-control form-control-sm" style="width:100%;"></td>
                                        <td><input type="text" class="form-control form-control-sm" style="width:100%;"></td>
                                        <td>
                                            <select id="LikelihoodDDL" class="form-control">
                                                <option value="1">1</option>
                                                <option value="2">2</option>
                                                <option value="4">4</option>
                                                <option value="8">8</option>
                                            </select>
                                        </td>
                                        <td><input type="text" class="form-control form-control-sm" style="width:100%;"></td>
                                        <td>
                                            <select id="DetectabilityDDL" class="form-control">
                                                <option value="1">1</option>
                                                <option value="2">2</option>
                                                <option value="3">3</option>
                                                <option value="4">4</option>
                                            </select>
                                        </td>
                                        <td>SxLxD</td>
                                        <td>Level Risk Color</td>
                                        <td>
                                            <select id="DetectabilityDDL" class="form-control">
                                                <option value="Low">Low</option>
                                                <option value="Medium">Medium</option>
                                            </select>
                                        </td>
                                        <td><input type="text" class="form-control form-control-sm" style="width:100%;"></td>
                                        <td>
                                            <select id="LikelihoodDDL" class="form-control">
                                                <option value="1">1</option>
                                                <option value="2">2</option>
                                                <option value="4">4</option>
                                                <option value="8">8</option>
                                            </select>
                                        </td>
                                        <td><input type="text" class="form-control form-control-sm" style="width:100%;"></td>
                                        <td>
                                            <select id="DetectabilityDDL" class="form-control">
                                                <option value="1">1</option>
                                                <option value="2">2</option>
                                                <option value="3">3</option>
                                                <option value="4">4</option>
                                            </select>
                                        </td>
                                        <td><input type="text" class="form-control form-control-sm" style="width:100%;"></td>
                                        <td>
                                            <select id="DetectabilityDDL" class="form-control">
                                                <option value="1">1</option>
                                                <option value="2">2</option>
                                                <option value="3">3</option>
                                                <option value="4">4</option>
                                            </select>
                                        </td>
                                        <td>SxLxD</td>
                                        <td>Level Risk Color</td>
                                        <td>PIC</td>
                                        <td>Due Date</td>
                                        <td><button class="form-control-sm">Add</button></td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- #/ container -->
    </div>
</div>

@*JQuery Library*@
@*<script src="../plugins/bootstrap-material-datetimepicker/js/bootstrap-material-datetimepicker.js"></script>
    <script src="../plugins/bootstrap-datepicker/bootstrap-datepicker.min.js"></script>*@
<script src="~/Content/Scripts/plugins/datatables/jquery.dataTables.min.js" defer></script>
<script src="~/Content/Scripts/plugins/jquery/jquery.min.js"></script>

<script>
    function populatePotentialRootCauseDDL(data) {
        $('#Aspect_DDL').append(new Option("*Pilih*", "-"));
        $.each(data, function (key, value) {
            if (Object.keys(value)[2] == "WAHType") {
                if ($("#Aspect_DDL option:contains(" + value.WAHType + ")").val() != value.WAHType) {
                    $('#Aspect_DDL').append(new Option(value.WAHType, value.WAHType));
                }
            }

            //if (Object.keys(value)[4] == "WAHDesc")
            //    $('#WAH_DDL').append(new Option(value.WAHDesc, value.WAHDesc));
        });

        $('#Aspect_DDL').change(function () {
            getWAH(data);
        });
    }

    function getWAH(data) {
        $('#WAH_DDL').empty();
        $('#WAH_DDL').append(new Option("*Pilih*", "-"));
        var aspect = $('#Aspect_DDL').val();
        $.each(data, function (key, value) {
            if (Object.keys(value)[2] == "WAHType") {
                if (aspect == value.WAHType) {
                    $('#WAH_DDL').append(new Option(value.WAHDesc, value.WAHDesc));
                }
            }
        });

        $('#WAH_DDL').change(function () {
            $('#WhyParent_DDL').empty();
            $.ajax({
                url: 'GetDataPIC',
                type: 'post',
                data: JSON.stringify({
                    Option: 4,
                    NO_CAPA: $('#input_NoCAPA').val(),
                    WAH: $('#WAH_DDL').val(),
                    Aspect: aspect,
                    SP: "[dbo].[SP_FORM_CAPA]"
                }),
                dataType: 'json',
                contentType: 'application/json; charset=utf-8',
                success: function (data) {
                    $.each(JSON.parse(data), function (key, value) {
                        $('#WhyParent_DDL').append(new Option(value.WhyDescription, value.WhyDescription));
                    });
                },
                error: function (ex) {
                    alert(JSON.stringify(ex));
                }
            });
        });
    }

    function getTable() {
        //Jquery untuk panggil datasource datatable
        $('#Aspect_DDL').empty();
        $('#WAH_DDL').empty();
        $('#Tbl_Analisa').empty();

        $.ajax({
            url: 'GetDataPIC',
            type: 'post',
            data: JSON.stringify({
                Option: 2,
                NO_CAPA: $('#input_NoCAPA').val(),
                SP: "[dbo].[SP_FORM_CAPA]"
            }),
            dataType: 'json',
            contentType: 'application/json; charset=utf-8',
            success: function (data) {
                var t = $('#Tbl_Kondisi').DataTable({
                    "pageLength": 10,
                    "responsive": true,
                    "lengthChange": true,
                    "searching": false,
                    "data": JSON.parse(data),
                    "select": true,
                    "bDestroy": true,
                    "scrollCollapse": true,
                    "columns": [
                        { "data": null },
                        { "data": "WAHType" },
                        { "data": "WSBHDesc" },
                        { "data": "WAHDesc" },
                        { "data": "WAHStatus" },
                        {
                            "data": null,
                            "defaultContent": "<span><a class='delete' href='' onclick='return false;' data-toggle='tooltip' data-placement='top' title='Close'><i class='fa fa-close color-danger'></i></a></span>"
                        }
                    ],
                    "order": [[1, 'asc']],
                    "columnDefs": [
                        {
                            "targets": 5,
                            "className": "text-center"
                        }
                    ]
                });
                //Indexing Number of Rows
                t.on('order.dt search.dt', function () {
                    t.column(0, { search: 'applied', order: 'applied' }).nodes().each(function (cell, i) {
                        cell.innerHTML = i + 1;
                    });
                }).draw();

                populatePotentialRootCauseDDL(JSON.parse(data)); // Fill Potential Root Cause Options Dropdownlist


            },
            error: function (ex) {
                alert(JSON.stringify(ex));
            }
        });
    }

    function retrieveData() {
        $.ajax({
            url: 'GetDataPIC',
            type: 'post',
            data: JSON.stringify({
                Option: 6,
                NO_CAPA: $('#input_NoCAPA').val(),
                SP: "[dbo].[SP_FORM_CAPA]"
            }),
            dataType: 'json',
            contentType: 'application/json; charset=utf-8',
            success: function (rootcause) {
                $('#RootCause_DDL').empty();
                $.each(JSON.parse(rootcause), function (key, value) {
                    $('#RootCause_DDL').append(new Option(value.WhyDesc, value.WhyDesc));
                });


                $('#btn_AddPerbaikan').click(function () {
                    var obj = JSON.parse(rootcause);
                    $.each(obj, function (key, value) {
                        if (value.WhyDesc == $('#RootCause_DDL').val()) {
                            return dto = {
                                Option: 7,
                                NO_CAPA: $('#input_NoCAPA').val(),
                                Aspect: value.Aspect,
                                WhyID: value.WhyID,
                                WhyParentID: value.ParentID,
                                RootCause: value.WhyDesc,
                                Tindakan: $('#TxtDeskripsiPerbaikan').val(),
                                Pelaksana: $('#TxtPelaksanaPerbaikan').val(),
                                LineNumber: value.LineNumber,
                                DueDate: $('#duedate_perbaikan').val(),
                                NamaPersonil: $('#TxtNamaPersonil').val(),
                                Email: $('#TxtEmailPelaksana').val(),
                                Is_AreaLain: $('input[name="Potensi"]:checked').val(),
                                SP: "[dbo].[SP_FORM_CAPA]"
                            }
                        }
                    });
                    addTindakan(dto);
                });

            },
            error: function (ex) {
                alert(JSON.stringify(ex));
            }
        });
    }

    function retrieveData2() {
        $.ajax({
            url: 'GetDataPIC',
            type: 'post',
            data: JSON.stringify({
                Option: 8,
                NO_CAPA: $('#input_NoCAPA').val(),
                SP: "[dbo].[SP_FORM_CAPA]"
            }),
            dataType: 'json',
            contentType: 'application/json; charset=utf-8',
            success: function (area_lain) {
                $('#AreaLain_DDL').empty();
                $.each(JSON.parse(area_lain), function (key, value) {
                    $('#AreaLain_DDL').append(new Option(value.WhyDesc, value.WhyDesc));
                });

                $('#btn_AddPencegahan').click(function () {
                    var obj = JSON.parse(area_lain);
                    $.each(obj, function (key, value) {
                        if (value.WhyDesc == $('#AreaLain_DDL').val()) {
                            return dto = {
                                Option: 9,
                                NO_CAPA: $('#input_NoCAPA').val(),
                                Aspect: value.WAHType_FK,
                                WhyID: value.WhyID,
                                WhyParentID: value.WhyParentID,
                                RootCause: value.WhyDesc,
                                Tindakan: $('#TxtDeskripsiPencegahan').val(),
                                Pelaksana: $('#TxtPelaksanaPencegahan').val(),
                                LineNumber: value.LineNumber,
                                DueDate: $('#duedate_pencegahan').val(),
                                NamaPersonil: $('#TxtNamaPersonilPencegahan').val(),
                                Email: $('#TxtEmailPencegahan').val(),
                                SP: "[dbo].[SP_FORM_CAPA]"
                            }
                        }
                    });
                    addTindakan(dto);
                });

            },
            error: function (ex) {
                alert(JSON.stringify(ex));
            }
        });
    }

    function addTindakan(dto) {
        var valid = false;
        console.log(dto);
        $.each(dto, function (key, value) {
            if (value == '') {
                if (value == 0)
                    return valid = true;
                else
                    return valid = false;
            } else {
                valid = true;
            }
        });

        if (valid) {
            $.ajax({
                url: 'AddTindakan',
                type: 'post',
                data: JSON.stringify(dto),
                dataType: 'json',
                contentType: 'application/json; charset=utf-8',

                success: function (data) {
                    var status = JSON.parse(data);
                    if (status[0].Status_Inserted != 'Tindakan Perbaikan' || status[0].Status_Inserted != 'Tindakan Pencegahan') {
                        Swal.fire(
                            'Success',
                            'Tindakan ' + status[0].Status_Inserted + ' berhasil di-input.',
                            'success'
                        ).then((result) => {
                            if (result.value) {
                                retrieveData();
                                retrieveData2();
                                KajianResikoDDL();
                            }
                        });
                    }
                },
                error: function (ex) {
                    alert(JSON.stringify(ex));
                }
            });
        } else {
            Swal.fire(
                'Maaf',
                'Input tidak boleh kosong.',
                'warning'
            )
        }
    }

    function KajianResikoDDL() {
        $.ajax({
            url: 'GetDataPIC',
            type: 'post',
            data: JSON.stringify({
                Option: 10,
                SP: "[dbo].[SP_FORM_CAPA]"
            }),
            dataType: 'json',
            contentType: 'application/json; charset=utf-8',
            success: function (data) {
                $('#RootCause_KajianResikoDDL').empty();
                $.each(JSON.parse(data), function (key, value) {
                    $('#RootCause_KajianResikoDDL').append(new Option(value.WhyDesc, value.WhyDesc));
                });
            },
            error: function (ex) {
                alert(JSON.stringify(ex));
            }
        });
    }

    $(document).ready(function () {
        KajianResikoDDL();
        getTable();
        retrieveData();
        retrieveData2();

        $("#isParent").change(function () {
            if ($("#isParent").prop('checked') == true) {
                $("#Div_WhyParent").prop('hidden', true);
                return;
            }
            $("#Div_WhyParent").prop('hidden', false);
        });

        $('#btn_AddWhy').click(function () {
            dto = {
                Option: 3,
                NO_CAPA: $('#input_NoCAPA').val(),
                Aspect: $('#Aspect_DDL').val(),
                WAH: $('#WAH_DDL').val(),
                isParent: ($("#isParent[type='checkbox']:checked").val() == "Yes") ? (1) : (0),
                WHY_Parent: $('#WhyParent_DDL').val(),
                WHY: $('#TxtWhy').val(),
                SP: "[dbo].[SP_FORM_CAPA]"
            }

            $.ajax({
                url: 'AddWhy',
                type: 'post',
                data: JSON.stringify(dto),
                dataType: 'json',
                contentType: 'application/json; charset=utf-8',
                success: function (data) {

                },
                error: function (ex) {
                    alert(JSON.stringify(ex));
                }
            });
        });

        $('#btn_AddKondisi').click(function () {
            var valid = false;
            dto = {
                Option: 1,
                NO_CAPA: $('#input_NoCAPA').val(),
                Aspect: $('#Select_AspectKondisi').val(),
                WSBH: $('#TxtWSBH').val(),
                WAH: $('#TxtWAH').val(),
                Status: $("input[name=optradio]:checked").val(),
                SP: "[dbo].[SP_FORM_CAPA]"
            }

            $.each(dto, function (key, value) {
                if (value == '') {
                    return valid = false;
                } else {
                    valid = true;
                }
            });

            if (valid) {
                $.ajax({
                    url: 'AddKondisi',
                    type: 'post',
                    data: JSON.stringify(dto),
                    dataType: 'json',
                    contentType: 'application/json; charset=utf-8',

                    success: function (data) {
                        if (data == 'VALID') {
                            Swal.fire(
                                'Success',
                                'Data berhasil di-input.',
                                'success'
                            ).then((result) => {
                                if (result.value) {
                                    getTable();
                                }
                            })
                        }
                        //$.each(data, function (key, value) {
                        //    if (Object.keys(value)[3] == "Aspect") {
                        //        if ($("#Aspect_DDL option:contains(" + value.Aspect + ")").val() != value.Aspect) {
                        //            $('#Aspect_DDL').append(new Option(value.Aspect, value.Aspect));
                        //        }
                        //    }
                        //    if (Object.keys(value)[5] == "WAH")
                        //        $('#WAH_DDL').append(new Option(value.WAH, value.WAH));
                        //});
                    },
                    error: function (ex) {
                        alert(JSON.stringify(ex));
                    }
                });
            } else {
                Swal.fire(
                    'Maaf',
                    'Input tidak boleh kosong.',
                    'warning'
                )
            }
        });

        $(document).on("click", "#Tbl_Analisa a.delete", function () {
            var temp = [];
            var columns = $(this).closest('tr').find('td');
            $.each(columns, function (i, item) {
                var obj = {};
                obj.name = item.innerHTML;
                temp.push(obj);
                //console.log(i + item.innerHTML);
                //console.log(arr[i]);
            });

            var dto = {
                Option: 5,
                No_CAPA: $('#input_NoCAPA').val(),
                WAH: temp[3].name,
                WSBH: temp[2].name,
                Aspect: temp[1].name,
                SP: "[dbo].[SP_FORM_CAPA]"
            }

            $.ajax({
                url: 'DeleteKondisi',
                type: 'post',
                dataType: 'json',
                data: JSON.stringify(dto),
                contentType: 'application/json; charset=utf-8',
                success: function (data) {
                    getTable();
                    return true;
                },
                error: function (ex) {
                    alert(JSON.stringify(ex));
                }
            });
        });

        var countYes = 0;
        var countNo = 0;
        $('input[name="Potensi"]').click(function () {
            if ($('input[name="Potensi"]:checked').val() == 'Yes') {
                countNo = 0;
                countYes++;
            } else {
                countYes = 0;
                countNo++;
            }
            if (countYes == 2 || countNo == 2) {
                countYes = 0;
                countNo = 0;
                $('input[name="Potensi"]').prop("checked", false);
            }

        });

        //Add Why Click Listener
        //var List = new Array();
        //$(document).on("click", "#Tbl_PRCA button.addWhy", function () {
        //    var row = $("#Tbl_PRCA tr");
        //    var data = {};
        //    data.Why = row.find("td:eq(2) input[type='text']").val();
        //    data.WAH = row.find("td:eq(1) input[type='text']").val();
        //    List.push(data);
        //    console.log(List);
        //    $('#Tbl_Why').empty();
        //    $.each(List, function (key, entry) {
        //        var trHTML = '<tr>' +
        //            '<td>' + entry.WAH + '</td>' +
        //            '<td>' + entry.Why + '</td>' +
        //            '<th><button class="form-control-sm deleteWhy">Delete</button></th>' +
        //            '</tr>';
        //        $('#Tbl_Why').append(trHTML);
        //    });
        //});
    });
</script>
