r
@{
    ViewBag.Title = "FormCAPA";
    Layout = "~/Views/Shared/_Layout.cshtml";
}


<div class="content-body">
    <!--Modal-->
    <div class="row page-titles mx-0">
        <div class="col p-md-0">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="javascript:void(0)">Dashboard</a></li>
                <li class="breadcrumb-item active"><a href="javascript:void(0)">Form CAPA</a></li>
            </ol>
        </div>
    </div>
    <!-- row -->

    <div class="container-fluid">
        <div class="row">
            <div class="col-lg-12">
                <div class="card">
                    <div class="card-body">
                        <h4 class="card-title">Form CAPA</h4>
                        <form>
                            <div class="row">
                                <div class="form-group mb-2 col-sm-3">
                                    <label class="m-t-20">Tanggal</label>
                                    <input type="text" id="date-format" class="form-control form-control-sm" value="@DateTime.Today.ToShortDateString()" readonly>
                                </div>
                                <div class="form-group mb-2 col-sm-3">
                                    <label class="m-t-40">Requestor</label>
                                    <input class="form-control form-control-sm" type="text" id="input_Requestor" readonly>
                                </div>
                                <div class="form-group mb-2 col-sm-3">
                                    <label class="m-t-20">Nomor CAPA</label>
                                    <input class="form-control form-control-sm" type="text" id="input_NoCAPA" readonly>
                                </div>
                                <div class="form-group mb-2 col-sm-3">
                                    <label class="m-t-40">Departemen</label>
                                    <input class="form-control form-control-sm" type="text" id="input_Departemen" readonly>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>

                <div class="card">
                    <div class="card-body">
                        <h4 class="card-title">Request</h4>
                        
                    </div>
                </div>

                <div class="card">
                    <div class="card-body">
                        <h4 class="card-title">Analisa Kondisi</h4>
                        <div class="table-responsive">
                            <table class="table table-striped table-bordered zero-configuration">
                                <thead>
                                    <tr>
                                        <th>Aspect</th>
                                        <th>WHAT SHOULD BE HAPPENED</th>
                                        <th>WHAT ACTUALLY HAPPENED</th>
                                        <th>OK/NOK</th>
                                        <th>Action</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>
                                            <select class="form-control form-control-sm" id="Select_AspectKondisi">
                                                <option>Manusia</option>
                                                <option>Material/Produk</option>
                                                <option>Metode</option>
                                                <option>Mesin</option>
                                                <option>Lingkungan</option>
                                            </select>
                                        </td>
                                        <td><input type="text" class="form-control form-control-sm" style="width:100%;" id="TxtWSBH"></td>
                                        <td><input type="text" class="form-control form-control-sm" style="width:100%;" id="TxtWAH"></td>
                                        <td><input type="text" class="form-control form-control-sm" style="width:100%;" id="TxtStatus"></td>
                                        <th><button class="form-control-sm" id="btn_AddKondisi">Add</button></th>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <div class="card" id="Div_PRCA">
                    <div class="card-body">
                        <h4 class="card-title">Potential Root Cause Analysis</h4>
                        @*<div class="table-responsive">
                    <!--<table class="table table-striped table-bordered zero-configuration">
                        <thead>
                            <tr>
                                <th>Aspect</th>
                                <th>WHAT ACTUALLY HAPPENED</th>
                                <th>WHY</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody id="Tbl_PRCA">
                            <tr>-->
                                @*<td>Manusia</td>
                <td><input type="text" class="form-control form-control-sm" style="width:100%;" readonly></td>
                <td><input type="text" class="form-control form-control-sm" style="width:100%;"></td>
                <th><button class="form-control-sm">Add</button></th>
                            <!--</tr>
                        </tbody>
                    </table>
                </div>-->*@
                        <form>
                            <div class="row form-group-sm mb-2">
                                <div class="col-md-6">
                                    <label class="m-t-20">Aspect<span style="color: red">*</span></label>
                                    <select class="form-control form-control-sm" id="Aspect_DDL" name="Aspect" required>
                                    </select>
                                </div>
                            </div>
                            <div class="row form-group-sm mb-2">
                                <div class="col-md-6">
                                    <label class="m-t-20">What Actually Happened<span style="color: red">*</span></label>
                                    <select class="form-control form-control-sm" id="WAH_DDL" name="WAH" required>
                                    </select>
                                </div>
                            </div>
                            <div class="row form-group-sm mb-2">
                                <div class="col-md-6">
                                    <label class="m-t-20">Parent?<span style="color: red; visibility: hidden">**</span></label>
                                    <input class="checkbox" type="checkbox" value="Parent" />
                                </div>
                            </div>
                            <div class="row form-group-sm mb-2">
                                <div class="col-md-6">
                                    <label class="m-t-20">Why Parent<span style="color: red">*</span></label>
                                    <input class="form-control" type="text" />
                                </div>
                            </div>
                            <div class="row form-group-sm mb-2">
                                <div class="col-md-6">
                                    <label class="m-t-20">Why<span style="color: red">*</span></label>
                                    <input class="form-control" type="text" />
                                </div>
                            </div>
                            <div class="row form-group-sm mb-2">
                                <div class="col-md-6">
                                    <button class="form-control-sm">Add</button>
                                </div>
                            </div>
                        </form>

                    </div>
                </div>

                <div class="card">
                    <div class="card-body">
                        <h4 class="card-title">Why</h4>
                        <div class="table-responsive">
                            <table class="table table-striped table-bordered zero-configuration">
                                <thead>
                                    <tr>
                                        <th>WHAT ACTUALLY HAPPENED</th>
                                        <th>WHY</th>
                                        <th>Action</th>
                                    </tr>
                                </thead>
                                <tbody id="Tbl_Why">
                                    <tr>
                                        @*<td>Manusia</td>
                                <td><input type="text" class="form-control form-control-sm" style="width:100%;" readonly></td>
                                <td><input type="text" class="form-control form-control-sm" style="width:100%;"></td>
                                <th><button class="form-control-sm">Add</button></th>*@
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-body">
                        <h4 class="card-title">Penentuan Tindakan Perbaikan</h4>
                        <div class="table-responsive">
                            <form>
                                <div class="row form-group-sm">
                                    <div class="col-md-6">
                                        <label class="m-t-20">Root Cause</label>
                                        <textarea type="text" class="form-control" placeholder="create otomatis Why terakhir dari halaman PIC CAPA Page 1"></textarea>
                                    </div>
                                </div>
                                <div class="row form-group-sm">
                                    <div class="col-md-6">
                                        <label class="m-t-20">Tindakan Perbaikan<span style="color: red">*</span></label>
                                        <textarea type="text" class="form-control" placeholder="Deskripsi"></textarea>
                                    </div>
                                    <div class="form-group mb-2 col-sm-3">
                                        <label class="m-t-20">Due Date</label>
                                        <input type="date" id="date-format" class="form-control form-control-sm">
                                    </div>
                                </div>
                                <div class="row form-group">
                                    <div class="col-md-6">
                                        <label class="m-t-40">Pelaksana Tindakan Perbaikan</label>
                                        <div class="input-group mb-3">
                                            <input type="text" class="form-control">
                                        </div>
                                    </div>
                                    <div class="col-md-4" style="text-align: center">
                                        <label class="m-t-40" style="visibility:hidden">_</label>
                                        <div class="input-group mb-3">
                                            <button type="button" class="btn mb-1 btn-primary ">Add</button>
                                            <button type="button" class="btn mb-1 btn-primary ">Browse</button>
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <label class="m-t-40">Nama Personil</label>
                                        <div class="input-group mb-3">
                                            <input type="text" class="form-control">
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <label class="m-t-40">Alamat Email</label>
                                        <div class="input-group mb-3">
                                            <input type="text" class="form-control">
                                        </div>
                                    </div>
                                    <div class="col-md-12 mb-3">
                                        <label class="m-t-40" style="visibility: hidden">_</label>
                                        <div class="input-group">
                                            <button type="button" class="btn mb-1 btn-primary ">Tambahkan Tindakan Perbaikan</button>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <label class="m-t-40">Apakah ada proses / area lain yang berpotensi sama ?</label>
                                        <div class="radio input-group">
                                            <div class="col-sm-3">
                                                <label><input type="radio" name="Potensi">Ya</label>
                                            </div>
                                            <div class="col-sm-3">
                                                <label><input type="radio" name="Potensi">Tidak</label>
                                            </div>
                                        </div>
                                    </div>

                                </div>
                            </form>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-body">
                        <h4 class="card-title">Penentuan Tindakan Pencegahan</h4>
                        <div class="table-responsive">
                            <form>
                                <div class="row form-group-sm">
                                    <div class="col-md-6">
                                        <label class="m-t-20">Root Cause</label>
                                        <textarea type="text" class="form-control" placeholder="create otomatis Why terakhir dari halaman PIC CAPA Page 1"></textarea>
                                    </div>
                                </div>
                                <div class="row form-group-sm">
                                    <div class="col-md-6">
                                        <label class="m-t-20">Tindakan Perbaikan<span style="color: red">*</span></label>
                                        <textarea type="text" class="form-control" placeholder="Deskripsi"></textarea>
                                    </div>
                                    <div class="form-group mb-2 col-sm-3">
                                        <label class="m-t-20">Due Date</label>
                                        <input type="date" id="date-format" class="form-control form-control-sm">
                                    </div>
                                </div>
                                <div class="row form-group">
                                    <div class="col-md-6">
                                        <label class="m-t-40">Pelaksana Tindakan Perbaikan</label>
                                        <div class="input-group mb-3">
                                            <input type="text" class="form-control">
                                        </div>
                                    </div>
                                    <div class="col-md-4" style="text-align: center">
                                        <label class="m-t-40" style="visibility:hidden">_</label>
                                        <div class="input-group mb-3">
                                            <button type="button" class="btn mb-1 btn-primary ">Add</button>
                                            <button type="button" class="btn mb-1 btn-primary ">Browse</button>
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <label class="m-t-40">Nama Personil</label>
                                        <div class="input-group mb-3">
                                            <input type="text" class="form-control">
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <label class="m-t-40">Alamat Email</label>
                                        <div class="input-group mb-3">
                                            <input type="text" class="form-control">
                                        </div>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-body">
                        <h4 class="card-title">Kajian Resiko</h4>
                        <div class="table-responsive">
                            <table class="table table-striped table-bordered zero-configuration" id="Tbl_KajianResiko">
                                <thead>
                                    <tr>
                                        <th>Potensi Kegagalan / Penyimpangan yang mungkin terjadi ketika tindakan perbaikan/pencegahan diterapkan</th>
                                        <th>Spesifikasi / Syarat</th>
                                        <th>Dampak</th>
                                        <th>Severity (S)</th>
                                        <th>Penyebab Potensial</th>
                                        <th>Mengatasi Penyebab Potensial</th>
                                        <th>Likelihood (L)</th>
                                        <th>Mencegah Potensi Kegagalan Lolos Menimbulkan Dampak</th>
                                        <th>Detectability (D) </th>
                                        <th>RPN (SxLxD)</th>
                                        <th style="background-color: limegreen">Risk Level</th>
                                        <th>TARGET</th>
                                        <th>Menghilangkan Potensi Kegagalan/ Penyimpangan</th>
                                        <th>Severity (S)</th>
                                        <th>PERBAIKAN untuk mengatasi Penyebab Potensial</th>
                                        <th>Likelihood (L)</th>
                                        <th>PERBAIKAN untuk meningkatkan deteksi potensi kegagalan</th>
                                        <th>Detectability (D)</th>
                                        <th>RPN (SxLxD)</th>
                                        <th style="background-color: limegreen">Risk Level</th>
                                        <th>PIC</th>
                                        <th>Due Date</th>
                                        <th>Action</th>
                                    </tr>
                                </thead>
                                <tbody id="Tbl_PRCA">
                                    <tr>
                                        <td><input type="text" class="form-control form-control-sm" style="width:100%;"></td>
                                        <td><input type="text" class="form-control form-control-sm" style="width:100%;"></td>
                                        <td><input type="text" class="form-control form-control-sm" style="width:100%;"></td>
                                        <td>
                                            <select id="SaverityDDL" class="form-control">
                                                <option value="1">1</option>
                                                <option value="4">4</option>
                                                <option value="7">7</option>
                                                <option value="10">10</option>
                                            </select>
                                        </td>
                                        <td><input type="text" class="form-control form-control-sm" style="width:100%;"></td>
                                        <td><input type="text" class="form-control form-control-sm" style="width:100%;"></td>
                                        <td>
                                            <select id="LikelihoodDDL" class="form-control">
                                                <option value="1">1</option>
                                                <option value="2">2</option>
                                                <option value="4">4</option>
                                                <option value="8">8</option>
                                            </select>
                                        </td>
                                        <td><input type="text" class="form-control form-control-sm" style="width:100%;"></td>
                                        <td>
                                            <select id="DetectabilityDDL" class="form-control">
                                                <option value="1">1</option>
                                                <option value="2">2</option>
                                                <option value="3">3</option>
                                                <option value="4">4</option>
                                            </select>
                                        </td>
                                        <td>SxLxD</td>
                                        <td>Level Risk Color</td>
                                        <td>
                                            <select id="DetectabilityDDL" class="form-control">
                                                <option value="Low">Low</option>
                                                <option value="Medium">Medium</option>
                                            </select>
                                        </td>
                                        <td><input type="text" class="form-control form-control-sm" style="width:100%;"></td>
                                        <td>
                                            <select id="LikelihoodDDL" class="form-control">
                                                <option value="1">1</option>
                                                <option value="2">2</option>
                                                <option value="4">4</option>
                                                <option value="8">8</option>
                                            </select>
                                        </td>
                                        <td><input type="text" class="form-control form-control-sm" style="width:100%;"></td>
                                        <td>
                                            <select id="DetectabilityDDL" class="form-control">
                                                <option value="1">1</option>
                                                <option value="2">2</option>
                                                <option value="3">3</option>
                                                <option value="4">4</option>
                                            </select>
                                        </td>
                                        <td><input type="text" class="form-control form-control-sm" style="width:100%;"></td>
                                        <td>
                                            <select id="DetectabilityDDL" class="form-control">
                                                <option value="1">1</option>
                                                <option value="2">2</option>
                                                <option value="3">3</option>
                                                <option value="4">4</option>
                                            </select>
                                        </td>
                                        <td>SxLxD</td>
                                        <td>Level Risk Color</td>
                                        <td>PIC</td>
                                        <td>Due Date</td>
                                        <td><button class="form-control-sm">Add</button></td>

                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- #/ container -->
    </div>
</div>

@*JQuery Library*@
@*<script src="../plugins/bootstrap-material-datetimepicker/js/bootstrap-material-datetimepicker.js"></script>
    <script src="../plugins/bootstrap-datepicker/bootstrap-datepicker.min.js"></script>*@

<script>
    $(document).ready(function () {
        $('#add_Content').click(function () {

        });

        $('#btn_AddKondisi').click(function () {
            var valid = false;
            dto = {
                Aspect: $('#Select_AspectKondisi').val(),
                WSBH: $('#TxtWSBH').val(),
                WAH: $('#TxtWAH').val(),
                Status: $('#TxtStatus').val()
            }

            $.each(dto, function (key, value) {
                if (value == '') {
                    return valid = false;
                } else {
                    valid = true;
                }
            });

            if (valid) {
                $.ajax({
                    url: 'AddKondisi',
                    type: 'post',
                    data: JSON.stringify(dto),
                    dataType: 'json',
                    contentType: 'application/json; charset=utf-8',

                    success: function (data) {                        
                        console.log(data);
                      
                      
                        $('#Aspect_DDL').empty();
                        $('#WAH_DDL').empty();
                        $.each(data, function (key, value) {                           
                            if (Object.keys(value)[0] == "Aspect") {
                                if ($("#Aspect_DDL option:contains(" + value.Aspect + ")").val() != value.Aspect) {
                                    $('#Aspect_DDL').append(new Option(value.Aspect, value.Aspect));
                                }                               
                            }                               
                            if (Object.keys(value)[2] == "WAH")
                                $('#WAH_DDL').append(new Option(value.WAH, value.WAH));
                        });
                       
                    },
                    error: function (ex) {
                        alert(JSON.stringify(ex));
                    }
                });
            } else {
                Swal.fire(
                    'Maaf',
                    'Input tidak boleh kosong.',
                    'warning'
                )
            }
        });

        //Add Why Click Listener
        var List = new Array();
        $(document).on("click", "#Tbl_PRCA button.addWhy", function () {
            var row = $("#Tbl_PRCA tr");
            var data = {};
            data.Why = row.find("td:eq(2) input[type='text']").val();
            data.WAH = row.find("td:eq(1) input[type='text']").val();
            List.push(data);
            console.log(List);
            $('#Tbl_Why').empty();
            $.each(List, function (key, entry) {
                var trHTML = '<tr>' +
                    '<td>' + entry.WAH + '</td>' +
                    '<td>' + entry.Why + '</td>' +
                    '<th><button class="form-control-sm deleteWhy">Delete</button></th>' +
                    '</tr>';
                $('#Tbl_Why').append(trHTML);
            });
        });
    });
</script>
